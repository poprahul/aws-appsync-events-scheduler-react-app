{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { QueryDocumentKeys } from \"graphql/language/visitor\";\nvar CIRCULAR = Object.create(null);\nvar objToStr = Object.prototype.toString;\n\nvar QueryKeyMaker = function () {\n  function QueryKeyMaker(cacheKeyRoot) {\n    this.cacheKeyRoot = cacheKeyRoot;\n    this.perQueryKeyMakers = new Map();\n  }\n\n  QueryKeyMaker.prototype.forQuery = function (document) {\n    if (!this.perQueryKeyMakers.has(document)) {\n      this.perQueryKeyMakers.set(document, new PerQueryKeyMaker(this.cacheKeyRoot, document));\n    }\n\n    return this.perQueryKeyMakers.get(document);\n  };\n\n  return QueryKeyMaker;\n}();\n\nexport { QueryKeyMaker };\n\nvar PerQueryKeyMaker = function () {\n  function PerQueryKeyMaker(cacheKeyRoot, query) {\n    this.cacheKeyRoot = cacheKeyRoot;\n    this.query = query;\n    this.cache = new Map();\n    this.lookupArray = this.cacheMethod(this.lookupArray);\n    this.lookupObject = this.cacheMethod(this.lookupObject);\n    this.lookupFragmentSpread = this.cacheMethod(this.lookupFragmentSpread);\n  }\n\n  PerQueryKeyMaker.prototype.cacheMethod = function (method) {\n    var _this = this;\n\n    return function (value) {\n      if (_this.cache.has(value)) {\n        var cached = _this.cache.get(value);\n\n        if (cached === CIRCULAR) {\n          throw new Error(\"QueryKeyMaker cannot handle circular query structures\");\n        }\n\n        return cached;\n      }\n\n      _this.cache.set(value, CIRCULAR);\n\n      try {\n        var result = method.call(_this, value);\n\n        _this.cache.set(value, result);\n\n        return result;\n      } catch (e) {\n        _this.cache.delete(value);\n\n        throw e;\n      }\n    };\n  };\n\n  PerQueryKeyMaker.prototype.lookupQuery = function (document) {\n    return this.lookupObject(document);\n  };\n\n  PerQueryKeyMaker.prototype.lookupSelectionSet = function (selectionSet) {\n    return this.lookupObject(selectionSet);\n  };\n\n  PerQueryKeyMaker.prototype.lookupFragmentSpread = function (fragmentSpread) {\n    var name = fragmentSpread.name.value;\n    var fragment = null;\n    this.query.definitions.some(function (definition) {\n      if (definition.kind === \"FragmentDefinition\" && definition.name.value === name) {\n        fragment = definition;\n        return true;\n      }\n\n      return false;\n    });\n    return this.lookupObject(__assign({}, fragmentSpread, {\n      fragment: fragment\n    }));\n  };\n\n  PerQueryKeyMaker.prototype.lookupAny = function (value) {\n    if (Array.isArray(value)) {\n      return this.lookupArray(value);\n    }\n\n    if (typeof value === \"object\" && value !== null) {\n      if (value.kind === \"FragmentSpread\") {\n        return this.lookupFragmentSpread(value);\n      }\n\n      return this.lookupObject(value);\n    }\n\n    return value;\n  };\n\n  PerQueryKeyMaker.prototype.lookupArray = function (array) {\n    var elements = array.map(this.lookupAny, this);\n    return this.cacheKeyRoot.lookup(objToStr.call(array), this.cacheKeyRoot.lookupArray(elements));\n  };\n\n  PerQueryKeyMaker.prototype.lookupObject = function (object) {\n    var _this = this;\n\n    var keys = safeSortedKeys(object);\n    var values = keys.map(function (key) {\n      return _this.lookupAny(object[key]);\n    });\n    return this.cacheKeyRoot.lookup(objToStr.call(object), this.cacheKeyRoot.lookupArray(keys), this.cacheKeyRoot.lookupArray(values));\n  };\n\n  return PerQueryKeyMaker;\n}();\n\nvar queryKeyMap = Object.create(null);\nObject.keys(QueryDocumentKeys).forEach(function (parentKind) {\n  var childKeys = queryKeyMap[parentKind] = Object.create(null);\n  QueryDocumentKeys[parentKind].forEach(function (childKey) {\n    childKeys[childKey] = true;\n  });\n\n  if (parentKind === \"FragmentSpread\") {\n    childKeys[\"fragment\"] = true;\n  }\n});\n\nfunction safeSortedKeys(object) {\n  var keys = Object.keys(object);\n  var keyCount = keys.length;\n  var knownKeys = typeof object.kind === \"string\" && queryKeyMap[object.kind];\n  var target = 0;\n\n  for (var source = target; source < keyCount; ++source) {\n    var key = keys[source];\n    var value = object[key];\n    var isObjectOrArray = value !== null && typeof value === \"object\";\n\n    if (!isObjectOrArray || !knownKeys || knownKeys[key] === true) {\n      keys[target++] = key;\n    }\n  }\n\n  keys.length = target;\n  return keys.sort();\n}","map":{"version":3,"sources":["../src/queryKeyMaker.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAEA,SAAS,iBAAT,QAAkC,0BAAlC;AAEA,IAAM,QAAQ,GAAG,MAAM,CAAC,MAAP,CAAc,IAAd,CAAjB;AACA,IAAM,QAAQ,GAAG,MAAM,CAAC,SAAP,CAAiB,QAAlC;;AAEA,IAAA,aAAA,GAAA,YAAA;AAGE,WAAA,aAAA,CAAoB,YAApB,EAA8C;AAA1B,SAAA,YAAA,GAAA,YAAA;AAFZ,SAAA,iBAAA,GAAoB,IAAI,GAAJ,EAApB;AAE0C;;AAE3C,EAAA,aAAA,CAAA,SAAA,CAAA,QAAA,GAAP,UAAgB,QAAhB,EAAsC;AACpC,QAAI,CAAE,KAAK,iBAAL,CAAuB,GAAvB,CAA2B,QAA3B,CAAN,EAA4C;AAC1C,WAAK,iBAAL,CAAuB,GAAvB,CACE,QADF,EAEE,IAAI,gBAAJ,CAAqB,KAAK,YAA1B,EAAwC,QAAxC,CAFF;AAID;;AACD,WAAO,KAAK,iBAAL,CAAuB,GAAvB,CAA2B,QAA3B,CAAP;AACD,GARM;;AAST,SAAA,aAAA;AAAC,CAdD,EAAA;;;;AAgBA,IAAA,gBAAA,GAAA,YAAA;AAGE,WAAA,gBAAA,CACU,YADV,EAEU,KAFV,EAE6B;AADnB,SAAA,YAAA,GAAA,YAAA;AACA,SAAA,KAAA,GAAA,KAAA;AAJF,SAAA,KAAA,GAAQ,IAAI,GAAJ,EAAR;AAMN,SAAK,WAAL,GAAmB,KAAK,WAAL,CAAiB,KAAK,WAAtB,CAAnB;AACA,SAAK,YAAL,GAAoB,KAAK,WAAL,CAAiB,KAAK,YAAtB,CAApB;AACA,SAAK,oBAAL,GAA4B,KAAK,WAAL,CAAiB,KAAK,oBAAtB,CAA5B;AACD;;AAEO,EAAA,gBAAA,CAAA,SAAA,CAAA,WAAA,GAAR,UAA0B,MAA1B,EAAiD;AAAjD,QAAA,KAAA,GAAA,IAAA;;AACE,WAAO,UAAC,KAAD,EAAS;AACd,UAAI,KAAI,CAAC,KAAL,CAAW,GAAX,CAAe,KAAf,CAAJ,EAA2B;AACzB,YAAM,MAAM,GAAG,KAAI,CAAC,KAAL,CAAW,GAAX,CAAe,KAAf,CAAf;;AACA,YAAI,MAAM,KAAK,QAAf,EAAyB;AACvB,gBAAM,IAAI,KAAJ,CAAU,uDAAV,CAAN;AACD;;AACD,eAAO,MAAP;AACD;;AACD,MAAA,KAAI,CAAC,KAAL,CAAW,GAAX,CAAe,KAAf,EAAsB,QAAtB;;AACA,UAAI;AACF,YAAM,MAAM,GAAG,MAAM,CAAC,IAAP,CAAY,KAAZ,EAAkB,KAAlB,CAAf;;AACA,QAAA,KAAI,CAAC,KAAL,CAAW,GAAX,CAAe,KAAf,EAAsB,MAAtB;;AACA,eAAO,MAAP;AACD,OAJD,CAIE,OAAO,CAAP,EAAU;AACV,QAAA,KAAI,CAAC,KAAL,CAAW,MAAX,CAAkB,KAAlB;;AACA,cAAM,CAAN;AACD;AACF,KAjBD;AAkBD,GAnBO;;AAqBD,EAAA,gBAAA,CAAA,SAAA,CAAA,WAAA,GAAP,UAAmB,QAAnB,EAAyC;AACvC,WAAO,KAAK,YAAL,CAAkB,QAAlB,CAAP;AACD,GAFM;;AAIA,EAAA,gBAAA,CAAA,SAAA,CAAA,kBAAA,GAAP,UAA0B,YAA1B,EAAwD;AACtD,WAAO,KAAK,YAAL,CAAkB,YAAlB,CAAP;AACD,GAFM;;AAIC,EAAA,gBAAA,CAAA,SAAA,CAAA,oBAAA,GAAR,UAA6B,cAA7B,EAA+D;AAC7D,QAAM,IAAI,GAAG,cAAc,CAAC,IAAf,CAAoB,KAAjC;AACA,QAAI,QAAQ,GAA2B,IAAvC;AAEA,SAAK,KAAL,CAAW,WAAX,CAAuB,IAAvB,CAA4B,UAAA,UAAA,EAAU;AACpC,UAAI,UAAU,CAAC,IAAX,KAAoB,oBAApB,IACA,UAAU,CAAC,IAAX,CAAgB,KAAhB,KAA0B,IAD9B,EACoC;AAClC,QAAA,QAAQ,GAAG,UAAX;AACA,eAAO,IAAP;AACD;;AACD,aAAO,KAAP;AACD,KAPD;AAWA,WAAO,KAAK,YAAL,CAAiB,QAAA,CAAA,EAAA,EACnB,cADmB,EACL;AACjB,MAAA,QAAQ,EAAA;AADS,KADK,CAAjB,CAAP;AAID,GAnBO;;AAqBA,EAAA,gBAAA,CAAA,SAAA,CAAA,SAAA,GAAR,UAAkB,KAAlB,EAA4B;AAC1B,QAAI,KAAK,CAAC,OAAN,CAAc,KAAd,CAAJ,EAA0B;AACxB,aAAO,KAAK,WAAL,CAAiB,KAAjB,CAAP;AACD;;AAED,QAAI,OAAO,KAAP,KAAiB,QAAjB,IAA6B,KAAK,KAAK,IAA3C,EAAiD;AAC/C,UAAI,KAAK,CAAC,IAAN,KAAe,gBAAnB,EAAqC;AACnC,eAAO,KAAK,oBAAL,CAA0B,KAA1B,CAAP;AACD;;AACD,aAAO,KAAK,YAAL,CAAkB,KAAlB,CAAP;AACD;;AAED,WAAO,KAAP;AACD,GAbO;;AAeA,EAAA,gBAAA,CAAA,SAAA,CAAA,WAAA,GAAR,UAAoB,KAApB,EAAgC;AAC9B,QAAM,QAAQ,GAAG,KAAK,CAAC,GAAN,CAAU,KAAK,SAAf,EAA0B,IAA1B,CAAjB;AACA,WAAO,KAAK,YAAL,CAAkB,MAAlB,CACL,QAAQ,CAAC,IAAT,CAAc,KAAd,CADK,EAEL,KAAK,YAAL,CAAkB,WAAlB,CAA8B,QAA9B,CAFK,CAAP;AAID,GANO;;AAQA,EAAA,gBAAA,CAAA,SAAA,CAAA,YAAA,GAAR,UAAqB,MAArB,EAAmD;AAAnD,QAAA,KAAA,GAAA,IAAA;;AACE,QAAM,IAAI,GAAG,cAAc,CAAC,MAAD,CAA3B;AACA,QAAM,MAAM,GAAG,IAAI,CAAC,GAAL,CAAS,UAAA,GAAA,EAAG;AAAI,aAAA,KAAI,CAAC,SAAL,CAAe,MAAM,CAArB,GAAqB,CAArB,CAAA;AAA2B,KAA3C,CAAf;AACA,WAAO,KAAK,YAAL,CAAkB,MAAlB,CACL,QAAQ,CAAC,IAAT,CAAc,MAAd,CADK,EAEL,KAAK,YAAL,CAAkB,WAAlB,CAA8B,IAA9B,CAFK,EAGL,KAAK,YAAL,CAAkB,WAAlB,CAA8B,MAA9B,CAHK,CAAP;AAKD,GARO;;AASV,SAAA,gBAAA;AAAC,CA9FD,EAAA;;AAgGA,IAAM,WAAW,GAEb,MAAM,CAAC,MAAP,CAAc,IAAd,CAFJ;AAIA,MAAM,CAAC,IAAP,CAAY,iBAAZ,EAA+B,OAA/B,CAAuC,UAAA,UAAA,EAAU;AAC/C,MAAM,SAAS,GAAG,WAAW,CAAC,UAAD,CAAX,GAA0B,MAAM,CAAC,MAAP,CAAc,IAAd,CAA5C;AAEC,EAAA,iBAEC,CAAC,UAAD,CAFD,CAEc,OAFd,CAEsB,UAAA,QAAA,EAAQ;AAC7B,IAAA,SAAS,CAAC,QAAD,CAAT,GAAsB,IAAtB;AACD,GAJA;;AAMD,MAAI,UAAU,KAAK,gBAAnB,EAAqC;AAEnC,IAAA,SAAS,CAAC,UAAD,CAAT,GAAwB,IAAxB;AACD;AACF,CAbD;;AAeA,SAAS,cAAT,CAAwB,MAAxB,EAAsD;AACpD,MAAM,IAAI,GAAG,MAAM,CAAC,IAAP,CAAY,MAAZ,CAAb;AACA,MAAM,QAAQ,GAAG,IAAI,CAAC,MAAtB;AACA,MAAM,SAAS,GAAG,OAAO,MAAM,CAAC,IAAd,KAAuB,QAAvB,IAAmC,WAAW,CAAC,MAAM,CAAC,IAAR,CAAhE;AAIA,MAAI,MAAM,GAAG,CAAb;;AACA,OAAK,IAAI,MAAM,GAAG,MAAlB,EAA0B,MAAM,GAAG,QAAnC,EAA6C,EAAE,MAA/C,EAAuD;AACrD,QAAM,GAAG,GAAG,IAAI,CAAC,MAAD,CAAhB;AACA,QAAM,KAAK,GAAG,MAAM,CAAC,GAAD,CAApB;AACA,QAAM,eAAe,GAAG,KAAK,KAAK,IAAV,IAAkB,OAAO,KAAP,KAAiB,QAA3D;;AACA,QAAI,CAAE,eAAF,IAAqB,CAAE,SAAvB,IAAoC,SAAS,CAAC,GAAD,CAAT,KAAmB,IAA3D,EAAiE;AAC/D,MAAA,IAAI,CAAC,MAAM,EAAP,CAAJ,GAAiB,GAAjB;AACD;AACF;;AACD,EAAA,IAAI,CAAC,MAAL,GAAc,MAAd;AAEA,SAAO,IAAI,CAAC,IAAL,EAAP;AACD","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { QueryDocumentKeys } from \"graphql/language/visitor\";\nvar CIRCULAR = Object.create(null);\nvar objToStr = Object.prototype.toString;\nvar QueryKeyMaker = (function () {\n    function QueryKeyMaker(cacheKeyRoot) {\n        this.cacheKeyRoot = cacheKeyRoot;\n        this.perQueryKeyMakers = new Map();\n    }\n    QueryKeyMaker.prototype.forQuery = function (document) {\n        if (!this.perQueryKeyMakers.has(document)) {\n            this.perQueryKeyMakers.set(document, new PerQueryKeyMaker(this.cacheKeyRoot, document));\n        }\n        return this.perQueryKeyMakers.get(document);\n    };\n    return QueryKeyMaker;\n}());\nexport { QueryKeyMaker };\nvar PerQueryKeyMaker = (function () {\n    function PerQueryKeyMaker(cacheKeyRoot, query) {\n        this.cacheKeyRoot = cacheKeyRoot;\n        this.query = query;\n        this.cache = new Map;\n        this.lookupArray = this.cacheMethod(this.lookupArray);\n        this.lookupObject = this.cacheMethod(this.lookupObject);\n        this.lookupFragmentSpread = this.cacheMethod(this.lookupFragmentSpread);\n    }\n    PerQueryKeyMaker.prototype.cacheMethod = function (method) {\n        var _this = this;\n        return function (value) {\n            if (_this.cache.has(value)) {\n                var cached = _this.cache.get(value);\n                if (cached === CIRCULAR) {\n                    throw new Error(\"QueryKeyMaker cannot handle circular query structures\");\n                }\n                return cached;\n            }\n            _this.cache.set(value, CIRCULAR);\n            try {\n                var result = method.call(_this, value);\n                _this.cache.set(value, result);\n                return result;\n            }\n            catch (e) {\n                _this.cache.delete(value);\n                throw e;\n            }\n        };\n    };\n    PerQueryKeyMaker.prototype.lookupQuery = function (document) {\n        return this.lookupObject(document);\n    };\n    PerQueryKeyMaker.prototype.lookupSelectionSet = function (selectionSet) {\n        return this.lookupObject(selectionSet);\n    };\n    PerQueryKeyMaker.prototype.lookupFragmentSpread = function (fragmentSpread) {\n        var name = fragmentSpread.name.value;\n        var fragment = null;\n        this.query.definitions.some(function (definition) {\n            if (definition.kind === \"FragmentDefinition\" &&\n                definition.name.value === name) {\n                fragment = definition;\n                return true;\n            }\n            return false;\n        });\n        return this.lookupObject(__assign({}, fragmentSpread, { fragment: fragment }));\n    };\n    PerQueryKeyMaker.prototype.lookupAny = function (value) {\n        if (Array.isArray(value)) {\n            return this.lookupArray(value);\n        }\n        if (typeof value === \"object\" && value !== null) {\n            if (value.kind === \"FragmentSpread\") {\n                return this.lookupFragmentSpread(value);\n            }\n            return this.lookupObject(value);\n        }\n        return value;\n    };\n    PerQueryKeyMaker.prototype.lookupArray = function (array) {\n        var elements = array.map(this.lookupAny, this);\n        return this.cacheKeyRoot.lookup(objToStr.call(array), this.cacheKeyRoot.lookupArray(elements));\n    };\n    PerQueryKeyMaker.prototype.lookupObject = function (object) {\n        var _this = this;\n        var keys = safeSortedKeys(object);\n        var values = keys.map(function (key) { return _this.lookupAny(object[key]); });\n        return this.cacheKeyRoot.lookup(objToStr.call(object), this.cacheKeyRoot.lookupArray(keys), this.cacheKeyRoot.lookupArray(values));\n    };\n    return PerQueryKeyMaker;\n}());\nvar queryKeyMap = Object.create(null);\nObject.keys(QueryDocumentKeys).forEach(function (parentKind) {\n    var childKeys = queryKeyMap[parentKind] = Object.create(null);\n    QueryDocumentKeys[parentKind].forEach(function (childKey) {\n        childKeys[childKey] = true;\n    });\n    if (parentKind === \"FragmentSpread\") {\n        childKeys[\"fragment\"] = true;\n    }\n});\nfunction safeSortedKeys(object) {\n    var keys = Object.keys(object);\n    var keyCount = keys.length;\n    var knownKeys = typeof object.kind === \"string\" && queryKeyMap[object.kind];\n    var target = 0;\n    for (var source = target; source < keyCount; ++source) {\n        var key = keys[source];\n        var value = object[key];\n        var isObjectOrArray = value !== null && typeof value === \"object\";\n        if (!isObjectOrArray || !knownKeys || knownKeys[key] === true) {\n            keys[target++] = key;\n        }\n    }\n    keys.length = target;\n    return keys.sort();\n}\n//# sourceMappingURL=queryKeyMaker.js.map"]},"metadata":{},"sourceType":"module"}