{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*!\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nvar apollo_cache_inmemory_1 = require(\"apollo-cache-inmemory\");\n\nvar apollo_link_1 = require(\"apollo-link\");\n\nvar apollo_utilities_1 = require(\"apollo-utilities\");\n\nvar constants_1 = require(\"@redux-offline/redux-offline/lib/constants\");\n\nvar cache_1 = require(\"../cache\");\n\nvar utils_1 = require(\"../utils\");\n\nvar apollo_client_1 = require(\"apollo-client\");\n\nvar retry_link_1 = require(\"./retry-link\");\n\nvar logger = utils_1.rootLogger.extend('offline-link');\nvar actions = {\n  SAVE_SNAPSHOT: 'SAVE_SNAPSHOT',\n  ENQUEUE: 'ENQUEUE_OFFLINE_MUTATION',\n  COMMIT: 'COMMIT_OFFLINE_MUTATION',\n  ROLLBACK: 'ROLLBACK_OFFLINE_MUTATION',\n  SAVE_SERVER_ID: 'SAVE_SERVER_ID'\n};\nvar IS_OPTIMISTIC_KEY = typeof Symbol !== 'undefined' ? Symbol('isOptimistic') : '@@isOptimistic';\n\nexports.isOptimistic = function (obj) {\n  return typeof obj[IS_OPTIMISTIC_KEY] !== undefined ? !!obj[IS_OPTIMISTIC_KEY] : false;\n};\n\nvar OfflineLink =\n/** @class */\nfunction (_super) {\n  __extends(OfflineLink, _super);\n\n  function OfflineLink(store) {\n    var _this = _super.call(this) || this;\n\n    _this.store = store;\n    return _this;\n  }\n\n  OfflineLink.prototype.request = function (operation, forward) {\n    var _this = this;\n\n    return new apollo_link_1.Observable(function (observer) {\n      var _a;\n\n      var online = _this.store.getState().offline.online;\n\n      var operationType = apollo_utilities_1.getOperationDefinition(operation.query).operation;\n      var isMutation = operationType === 'mutation';\n      var isQuery = operationType === 'query';\n\n      if (!online && isQuery) {\n        var data = processOfflineQuery(operation, _this.store);\n        observer.next({\n          data: data\n        });\n        observer.complete();\n        return function () {\n          return null;\n        };\n      }\n\n      if (isMutation) {\n        var _b = operation.getContext(),\n            _c = _b.AASContext,\n            _d = (_c === void 0 ? {} : _c).doIt,\n            doIt = _d === void 0 ? false : _d,\n            cache = _b.cache;\n\n        if (!doIt) {\n          var _e = cache_1.METADATA_KEY,\n              enqueuedMutations = _this.store.getState()[_e].snapshot.enqueuedMutations;\n\n          if (enqueuedMutations === 0) {\n            exports.boundSaveSnapshot(_this.store, cache);\n          }\n\n          var data = enqueueMutation(operation, _this.store, observer);\n\n          if (!online) {\n            observer.next((_a = {\n              data: data\n            }, _a[IS_OPTIMISTIC_KEY] = true, _a));\n            observer.complete();\n          }\n\n          return function () {\n            return null;\n          };\n        }\n      }\n\n      var handle = forward(operation).subscribe({\n        next: observer.next.bind(observer),\n        error: observer.error.bind(observer),\n        complete: observer.complete.bind(observer)\n      });\n      return function () {\n        if (handle) handle.unsubscribe();\n      };\n    });\n  };\n\n  return OfflineLink;\n}(apollo_link_1.ApolloLink);\n\nexports.OfflineLink = OfflineLink;\n\nexports.boundSaveSnapshot = function (store, cache) {\n  return store.dispatch(saveSnapshot(cache));\n};\n\nvar saveSnapshot = function (cache) {\n  return {\n    type: actions.SAVE_SNAPSHOT,\n    payload: {\n      cache: cache\n    }\n  };\n};\n\nvar processOfflineQuery = function (operation, theStore) {\n  var _a = cache_1.NORMALIZED_CACHE_KEY,\n      _b = theStore.getState()[_a],\n      normalizedCache = _b === void 0 ? {} : _b;\n\n  var query = operation.query,\n      variables = operation.variables;\n  var cache = operation.getContext().cache;\n  var store = apollo_cache_inmemory_1.defaultNormalizedCacheFactory(normalizedCache);\n  var data = cache.storeReader.readQueryFromStore({\n    store: store,\n    query: query,\n    variables: variables\n  });\n  return data;\n};\n\nvar enqueueMutation = function (operation, theStore, observer) {\n  var mutation = operation.query,\n      variables = operation.variables;\n  var _a = operation.getContext().AASContext,\n      origOptimistic = _a.optimisticResponse,\n      update = _a.update,\n      updateQueries = _a.updateQueries,\n      refetchQueries = _a.refetchQueries,\n      fetchPolicy = _a.fetchPolicy;\n  var optimisticResponse = typeof origOptimistic === 'function' ? origOptimistic(variables) : origOptimistic;\n  setImmediate(function () {\n    var effect = {\n      optimisticResponse: optimisticResponse,\n      operation: operation,\n      update: update,\n      updateQueries: updateQueries,\n      refetchQueries: refetchQueries,\n      fetchPolicy: fetchPolicy,\n      observer: observer\n    };\n    theStore.dispatch({\n      type: actions.ENQUEUE,\n      payload: {\n        optimisticResponse: optimisticResponse\n      },\n      meta: {\n        offline: {\n          effect: effect,\n          commit: {\n            type: actions.COMMIT\n          },\n          rollback: {\n            type: actions.ROLLBACK\n          }\n        }\n      }\n    });\n  });\n  var result;\n\n  if (optimisticResponse) {\n    result = optimisticResponse;\n  } else {\n    var mutationDefinition = apollo_utilities_1.getMutationDefinition(mutation);\n    result = mutationDefinition.selectionSet.selections.reduce(function (acc, elem) {\n      acc[apollo_utilities_1.resultKeyNameFromField(elem)] = null;\n      return acc;\n    }, {});\n  }\n\n  return result;\n};\n\nvar effect = function (store, client, effect, action, callback) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var doIt, origOptimistic, _a, origVars, mutation, context, update, updateQueries, refetchQueries, fetchPolicy, observer, _b, idsMap, variables, optimisticResponse;\n\n    var _c;\n\n    return __generator(this, function (_d) {\n      switch (_d.label) {\n        case 0:\n          doIt = true;\n          origOptimistic = effect.optimisticResponse, _a = effect.operation, origVars = _a.variables, mutation = _a.query, context = _a.context, update = effect.update, updateQueries = effect.updateQueries, refetchQueries = effect.refetchQueries, fetchPolicy = effect.fetchPolicy, observer = effect.observer;\n          return [4\n          /*yield*/\n          , client.hydrated()];\n\n        case 1:\n          _d.sent();\n\n          _b = cache_1.METADATA_KEY, idsMap = store.getState()[_b].idsMap;\n          variables = __assign(__assign({}, exports.replaceUsingMap(__assign({}, origVars), idsMap)), (_c = {}, _c[retry_link_1.SKIP_RETRY_KEY] = true, _c));\n          optimisticResponse = exports.replaceUsingMap(__assign({}, origOptimistic), idsMap);\n          return [2\n          /*return*/\n          , new Promise(function (resolve, reject) {\n            if (!client.queryManager) {\n              client.initQueryManager();\n            }\n\n            var buildOperationForLink = client.queryManager.buildOperationForLink;\n\n            var extraContext = __assign(__assign({\n              AASContext: {\n                doIt: doIt\n              }\n            }, context), {\n              optimisticResponse: optimisticResponse\n            });\n\n            var operation = buildOperationForLink.call(client.queryManager, mutation, variables, extraContext);\n            logger('Executing link', operation);\n            apollo_link_1.execute(client.link, operation).subscribe({\n              next: function (data) {\n                var _a;\n\n                boundSaveServerId(store, optimisticResponse, data.data);\n\n                var _b = store.getState(),\n                    _c = cache_1.METADATA_KEY,\n                    _d = _b[_c],\n                    idsMap = _d.idsMap,\n                    cacheSnapshot = _d.snapshot.cache,\n                    _e = _b.offline.outbox,\n                    enquededMutations = _e.slice(1); // Restore from cache snapshot\n\n\n                client.cache.restore(cacheSnapshot);\n                var dataStore = client.queryManager.dataStore;\n\n                if (fetchPolicy !== 'no-cache') {\n                  dataStore.markMutationResult({\n                    mutationId: null,\n                    result: data,\n                    document: mutation,\n                    variables: variables,\n                    updateQueries: {},\n                    update: update\n                  });\n                }\n\n                exports.boundSaveSnapshot(store, client.cache); // Apply enqueued update functions to new cache\n\n                var enqueuedActionsFilter = [exports.offlineEffectConfig.enqueueAction];\n                enquededMutations.filter(function (_a) {\n                  var type = _a.type;\n                  return enqueuedActionsFilter.indexOf(type) > -1;\n                }).forEach(function (_a) {\n                  var effect = _a.meta.offline.effect;\n\n                  var _b = effect,\n                      _c = _b.operation,\n                      _d = _c === void 0 ? {} : _c,\n                      _e = _d.variables,\n                      variables = _e === void 0 ? {} : _e,\n                      _f = _d.query,\n                      document = _f === void 0 ? null : _f,\n                      update = _b.update,\n                      origOptimisticResponse = _b.optimisticResponse,\n                      fetchPolicy = _b.fetchPolicy;\n\n                  if (typeof update !== 'function') {\n                    logger('No update function for mutation', {\n                      document: document,\n                      variables: variables\n                    });\n                    return;\n                  }\n\n                  var optimisticResponse = exports.replaceUsingMap(__assign({}, origOptimisticResponse), idsMap);\n                  var result = {\n                    data: optimisticResponse\n                  };\n\n                  if (fetchPolicy !== 'no-cache') {\n                    logger('Running update function for mutation', {\n                      document: document,\n                      variables: variables\n                    });\n                    dataStore.markMutationResult({\n                      mutationId: null,\n                      result: result,\n                      document: document,\n                      variables: variables,\n                      updateQueries: {},\n                      update: update\n                    });\n                  }\n                });\n                client.queryManager.broadcastQueries();\n                resolve({\n                  data: data\n                });\n\n                if (observer.next && !observer.closed) {\n                  observer.next(__assign(__assign({}, data), (_a = {}, _a[IS_OPTIMISTIC_KEY] = false, _a)));\n                  observer.complete();\n                } else {// throw new Error('Manually interact with cache');\n                }\n\n                if (typeof callback === 'function') {\n                  var mutationName_1 = utils_1.getOperationFieldName(mutation);\n\n                  var _f = data.context || {},\n                      _g = _f.additionalDataContext,\n                      _h = (_g === void 0 ? {} : _g).newVars,\n                      newVars_1 = _h === void 0 ? operation.variables : _h,\n                      restContext = __rest(_f, [\"additionalDataContext\"]);\n\n                  if (!Object.keys(restContext || {}).length) {\n                    delete data.context;\n                  } else {\n                    data.context = restContext;\n                  }\n\n                  apollo_utilities_1.tryFunctionOrLogError(function () {\n                    var errors = data.errors ? {\n                      mutation: mutationName_1,\n                      variables: newVars_1,\n                      error: new apollo_client_1.ApolloError({\n                        graphQLErrors: data.errors\n                      }),\n                      notified: !!observer.next\n                    } : null;\n                    var success = errors === null ? __assign(__assign({\n                      mutation: mutationName_1,\n                      variables: newVars_1\n                    }, data), {\n                      notified: !!observer.next\n                    }) : null;\n                    callback(errors, success);\n                  });\n                }\n              },\n              error: function (err) {\n                logger('Error when executing link', err);\n                reject(err);\n              }\n            });\n          })];\n      }\n    });\n  });\n};\n\nvar reducer = function (dataIdFromObject) {\n  return function (state, action) {\n    var type = action.type,\n        payload = action.payload;\n\n    switch (type) {\n      case constants_1.PERSIST_REHYDRATE:\n        var _a = cache_1.METADATA_KEY,\n            rehydratedState = payload[_a];\n        return rehydratedState || state;\n\n      default:\n        var _b = state || {},\n            _c = _b.idsMap,\n            origIdsMap = _c === void 0 ? {} : _c,\n            _d = _b.snapshot,\n            origSnapshot = _d === void 0 ? {} : _d,\n            restState = __rest(_b, [\"idsMap\", \"snapshot\"]);\n\n        var snapshot = snapshotReducer(origSnapshot, action);\n        var idsMap = idsMapReducer(origIdsMap, __assign(__assign({}, action), {\n          remainingMutations: snapshot.enqueuedMutations\n        }), dataIdFromObject);\n        return __assign(__assign({}, restState), {\n          snapshot: snapshot,\n          idsMap: idsMap\n        });\n    }\n  };\n};\n\nvar snapshotReducer = function (state, action) {\n  var enqueuedMutations = enqueuedMutationsReducer(state && state.enqueuedMutations, action);\n  var cache = cacheSnapshotReducer(state && state.cache, __assign(__assign({}, action), {\n    enqueuedMutations: enqueuedMutations\n  }));\n  return {\n    enqueuedMutations: enqueuedMutations,\n    cache: cache\n  };\n};\n\nvar enqueuedMutationsReducer = function (state, action) {\n  if (state === void 0) {\n    state = 0;\n  }\n\n  var type = action.type;\n\n  switch (type) {\n    case actions.ENQUEUE:\n      return state + 1;\n\n    case actions.COMMIT:\n    case actions.ROLLBACK:\n      return state - 1;\n\n    default:\n      return state;\n  }\n};\n\nvar cacheSnapshotReducer = function (state, action) {\n  if (state === void 0) {\n    state = {};\n  }\n\n  var type = action.type,\n      payload = action.payload;\n\n  switch (type) {\n    case actions.SAVE_SNAPSHOT:\n      var cache = payload.cache;\n\n      var cacheContents = __assign({}, cache.extract(false));\n\n      return cacheContents;\n\n    default:\n      return state;\n  }\n};\n\nvar boundSaveServerId = function (store, optimisticResponse, data) {\n  return store.dispatch(saveServerId(optimisticResponse, data));\n};\n\nvar saveServerId = function (optimisticResponse, data) {\n  return {\n    type: actions.SAVE_SERVER_ID,\n    payload: {\n      data: data,\n      optimisticResponse: optimisticResponse\n    }\n  };\n};\n\nvar idsMapReducer = function (state, action, dataIdFromObject) {\n  if (state === void 0) {\n    state = {};\n  }\n\n  var type = action.type,\n      _a = action.payload,\n      payload = _a === void 0 ? {} : _a;\n  var optimisticResponse = payload.optimisticResponse;\n\n  switch (type) {\n    case actions.ENQUEUE:\n      var ids = exports.getIds(dataIdFromObject, optimisticResponse);\n      var entries = Object.values(ids).reduce(function (acc, id) {\n        return acc[id] = null, acc;\n      }, {});\n      return __assign(__assign({}, state), entries);\n\n    case actions.COMMIT:\n      var remainingMutations = action.remainingMutations; // Clear ids map on last mutation\n\n      return remainingMutations ? state : {};\n\n    case actions.SAVE_SERVER_ID:\n      var data = payload.data;\n      var oldIds = exports.getIds(dataIdFromObject, optimisticResponse);\n      var newIds = exports.getIds(dataIdFromObject, data);\n      var mapped = mapIds(oldIds, newIds);\n      return __assign(__assign({}, state), mapped);\n\n    default:\n      return state;\n  }\n};\n\nvar discard = function (callback, error, action, retries) {\n  var discardResult = _discard(error, action, retries);\n\n  if (discardResult) {\n    // Call global error callback and observer\n    var observer = action.meta.offline.effect.observer;\n\n    if (observer && !observer.closed) {\n      observer.error(error);\n    }\n\n    if (typeof callback === 'function') {\n      apollo_utilities_1.tryFunctionOrLogError(function () {\n        callback({\n          error: error\n        }, null);\n      });\n    }\n  }\n\n  return discardResult;\n};\n\nvar _discard = function (error, action, retries) {\n  var _a = error.graphQLErrors,\n      graphQLErrors = _a === void 0 ? [] : _a;\n\n  if (graphQLErrors.length) {\n    logger('Discarding action.', action, graphQLErrors);\n    return true;\n  } else {\n    var _b = error.networkError,\n        _c = (_b === void 0 ? {\n      graphQLErrors: []\n    } : _b).graphQLErrors,\n        graphQLErrors_1 = _c === void 0 ? [] : _c;\n    var appSyncClientError = graphQLErrors_1.find(function (err) {\n      return err.errorType && err.errorType.startsWith('AWSAppSyncClient:');\n    });\n\n    if (appSyncClientError) {\n      logger('Discarding action.', action, appSyncClientError);\n      return true;\n    }\n  }\n\n  return error.permanent || retries > 10;\n}; //#region utils\n\n\nexports.replaceUsingMap = function (obj, map) {\n  if (map === void 0) {\n    map = {};\n  }\n\n  if (!obj || !map) {\n    return obj;\n  }\n\n  var newVal = map[obj];\n\n  if (newVal) {\n    obj = newVal;\n    return obj;\n  }\n\n  if (typeof obj === 'object') {\n    Object.keys(obj).forEach(function (key) {\n      var val = obj[key];\n\n      if (Array.isArray(val)) {\n        obj[key] = val.map(function (v, i) {\n          return exports.replaceUsingMap(v, map);\n        });\n      } else if (typeof val === 'object') {\n        obj[key] = exports.replaceUsingMap(val, map);\n      } else {\n        var newVal_1 = map[val];\n\n        if (newVal_1) {\n          obj[key] = newVal_1;\n        }\n      }\n    });\n  }\n\n  return obj;\n};\n\nexports.getIds = function (dataIdFromObject, obj, path, acc) {\n  if (path === void 0) {\n    path = '';\n  }\n\n  if (acc === void 0) {\n    acc = {};\n  }\n\n  if (!obj) {\n    return acc;\n  }\n\n  if (typeof obj === 'object') {\n    var dataId = dataIdFromObject(obj);\n\n    if (dataId) {\n      var _a = dataId.match(/(.+:)?(.+)/) || [],\n          _b = _a[2],\n          id = _b === void 0 ? null : _b;\n\n      if (utils_1.isUuid(dataId)) {\n        acc[path] = id;\n      }\n    }\n\n    Object.keys(obj).forEach(function (key) {\n      var val = obj[key];\n\n      if (Array.isArray(val)) {\n        val.forEach(function (v, i) {\n          return exports.getIds(dataIdFromObject, v, path + \".\" + key + \"[\" + i + \"]\", acc);\n        });\n      } else if (typeof val === 'object') {\n        exports.getIds(dataIdFromObject, val, \"\" + path + (path && '.') + key, acc);\n      }\n    });\n  }\n\n  return exports.getIds(dataIdFromObject, null, path, acc);\n};\n\nvar intersectingKeys = function (obj1, obj2) {\n  if (obj1 === void 0) {\n    obj1 = {};\n  }\n\n  if (obj2 === void 0) {\n    obj2 = {};\n  }\n\n  var keys1 = Object.keys(obj1);\n  var keys2 = Object.keys(obj2);\n  return keys1.filter(function (k) {\n    return keys2.indexOf(k) !== -1;\n  });\n};\n\nvar mapIds = function (obj1, obj2) {\n  return intersectingKeys(obj1, obj2).reduce(function (acc, k) {\n    return acc[obj1[k]] = obj2[k], acc;\n  }, {});\n}; //#endregion\n\n\nexports.offlineEffectConfig = {\n  enqueueAction: actions.ENQUEUE,\n  effect: effect,\n  discard: discard,\n  reducer: reducer\n};","map":{"version":3,"sources":["/Users/poprahul/workspace/frontend/amplify-apps/calandarApp/aws-mobile-appsync-events-starter-react/node_modules/aws-appsync/lib/link/offline-link.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","__generator","body","_","label","sent","trys","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","push","__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","defineProperty","exports","apollo_cache_inmemory_1","require","apollo_link_1","apollo_utilities_1","constants_1","cache_1","utils_1","apollo_client_1","retry_link_1","logger","rootLogger","extend","actions","SAVE_SNAPSHOT","ENQUEUE","COMMIT","ROLLBACK","SAVE_SERVER_ID","IS_OPTIMISTIC_KEY","isOptimistic","obj","undefined","OfflineLink","_super","store","_this","request","operation","forward","Observable","observer","_a","online","getState","offline","operationType","getOperationDefinition","query","isMutation","isQuery","data","processOfflineQuery","complete","_b","getContext","_c","AASContext","_d","doIt","cache","_e","METADATA_KEY","enqueuedMutations","snapshot","boundSaveSnapshot","enqueueMutation","handle","subscribe","bind","error","unsubscribe","ApolloLink","dispatch","saveSnapshot","type","payload","theStore","NORMALIZED_CACHE_KEY","normalizedCache","variables","defaultNormalizedCacheFactory","storeReader","readQueryFromStore","mutation","origOptimistic","optimisticResponse","update","updateQueries","refetchQueries","fetchPolicy","setImmediate","effect","meta","commit","rollback","mutationDefinition","getMutationDefinition","selectionSet","selections","reduce","acc","elem","resultKeyNameFromField","client","action","callback","origVars","context","idsMap","hydrated","replaceUsingMap","SKIP_RETRY_KEY","queryManager","initQueryManager","buildOperationForLink","extraContext","execute","link","boundSaveServerId","cacheSnapshot","outbox","enquededMutations","slice","restore","dataStore","markMutationResult","mutationId","document","enqueuedActionsFilter","offlineEffectConfig","enqueueAction","filter","forEach","_f","origOptimisticResponse","broadcastQueries","closed","mutationName_1","getOperationFieldName","_g","additionalDataContext","_h","newVars","newVars_1","restContext","keys","tryFunctionOrLogError","errors","ApolloError","graphQLErrors","notified","success","err","reducer","dataIdFromObject","state","PERSIST_REHYDRATE","rehydratedState","origIdsMap","origSnapshot","restState","snapshotReducer","idsMapReducer","remainingMutations","enqueuedMutationsReducer","cacheSnapshotReducer","cacheContents","extract","saveServerId","ids","getIds","entries","values","id","oldIds","newIds","mapped","mapIds","discard","retries","discardResult","_discard","networkError","graphQLErrors_1","appSyncClientError","find","errorType","startsWith","permanent","map","newVal","key","val","isArray","newVal_1","path","dataId","match","isUuid","intersectingKeys","obj1","obj2","keys1","keys2","k"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*!\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar apollo_cache_inmemory_1 = require(\"apollo-cache-inmemory\");\nvar apollo_link_1 = require(\"apollo-link\");\nvar apollo_utilities_1 = require(\"apollo-utilities\");\nvar constants_1 = require(\"@redux-offline/redux-offline/lib/constants\");\nvar cache_1 = require(\"../cache\");\nvar utils_1 = require(\"../utils\");\nvar apollo_client_1 = require(\"apollo-client\");\nvar retry_link_1 = require(\"./retry-link\");\nvar logger = utils_1.rootLogger.extend('offline-link');\nvar actions = {\n    SAVE_SNAPSHOT: 'SAVE_SNAPSHOT',\n    ENQUEUE: 'ENQUEUE_OFFLINE_MUTATION',\n    COMMIT: 'COMMIT_OFFLINE_MUTATION',\n    ROLLBACK: 'ROLLBACK_OFFLINE_MUTATION',\n    SAVE_SERVER_ID: 'SAVE_SERVER_ID',\n};\nvar IS_OPTIMISTIC_KEY = typeof Symbol !== 'undefined' ? Symbol('isOptimistic') : '@@isOptimistic';\nexports.isOptimistic = function (obj) { return typeof obj[IS_OPTIMISTIC_KEY] !== undefined ? !!obj[IS_OPTIMISTIC_KEY] : false; };\nvar OfflineLink = /** @class */ (function (_super) {\n    __extends(OfflineLink, _super);\n    function OfflineLink(store) {\n        var _this = _super.call(this) || this;\n        _this.store = store;\n        return _this;\n    }\n    OfflineLink.prototype.request = function (operation, forward) {\n        var _this = this;\n        return new apollo_link_1.Observable(function (observer) {\n            var _a;\n            var online = _this.store.getState().offline.online;\n            var operationType = apollo_utilities_1.getOperationDefinition(operation.query).operation;\n            var isMutation = operationType === 'mutation';\n            var isQuery = operationType === 'query';\n            if (!online && isQuery) {\n                var data = processOfflineQuery(operation, _this.store);\n                observer.next({ data: data });\n                observer.complete();\n                return function () { return null; };\n            }\n            if (isMutation) {\n                var _b = operation.getContext(), _c = _b.AASContext, _d = (_c === void 0 ? {} : _c).doIt, doIt = _d === void 0 ? false : _d, cache = _b.cache;\n                if (!doIt) {\n                    var _e = cache_1.METADATA_KEY, enqueuedMutations = _this.store.getState()[_e].snapshot.enqueuedMutations;\n                    if (enqueuedMutations === 0) {\n                        exports.boundSaveSnapshot(_this.store, cache);\n                    }\n                    var data = enqueueMutation(operation, _this.store, observer);\n                    if (!online) {\n                        observer.next((_a = { data: data }, _a[IS_OPTIMISTIC_KEY] = true, _a));\n                        observer.complete();\n                    }\n                    return function () { return null; };\n                }\n            }\n            var handle = forward(operation).subscribe({\n                next: observer.next.bind(observer),\n                error: observer.error.bind(observer),\n                complete: observer.complete.bind(observer),\n            });\n            return function () {\n                if (handle)\n                    handle.unsubscribe();\n            };\n        });\n    };\n    return OfflineLink;\n}(apollo_link_1.ApolloLink));\nexports.OfflineLink = OfflineLink;\nexports.boundSaveSnapshot = function (store, cache) { return store.dispatch(saveSnapshot(cache)); };\nvar saveSnapshot = function (cache) { return ({\n    type: actions.SAVE_SNAPSHOT,\n    payload: { cache: cache },\n}); };\nvar processOfflineQuery = function (operation, theStore) {\n    var _a = cache_1.NORMALIZED_CACHE_KEY, _b = theStore.getState()[_a], normalizedCache = _b === void 0 ? {} : _b;\n    var query = operation.query, variables = operation.variables;\n    var cache = operation.getContext().cache;\n    var store = apollo_cache_inmemory_1.defaultNormalizedCacheFactory(normalizedCache);\n    var data = cache.storeReader.readQueryFromStore({\n        store: store,\n        query: query,\n        variables: variables,\n    });\n    return data;\n};\nvar enqueueMutation = function (operation, theStore, observer) {\n    var mutation = operation.query, variables = operation.variables;\n    var _a = operation.getContext().AASContext, origOptimistic = _a.optimisticResponse, update = _a.update, updateQueries = _a.updateQueries, refetchQueries = _a.refetchQueries, fetchPolicy = _a.fetchPolicy;\n    var optimisticResponse = typeof origOptimistic === 'function' ? origOptimistic(variables) : origOptimistic;\n    setImmediate(function () {\n        var effect = {\n            optimisticResponse: optimisticResponse,\n            operation: operation,\n            update: update,\n            updateQueries: updateQueries,\n            refetchQueries: refetchQueries,\n            fetchPolicy: fetchPolicy,\n            observer: observer,\n        };\n        theStore.dispatch({\n            type: actions.ENQUEUE,\n            payload: { optimisticResponse: optimisticResponse },\n            meta: {\n                offline: {\n                    effect: effect,\n                    commit: { type: actions.COMMIT },\n                    rollback: { type: actions.ROLLBACK },\n                }\n            }\n        });\n    });\n    var result;\n    if (optimisticResponse) {\n        result = optimisticResponse;\n    }\n    else {\n        var mutationDefinition = apollo_utilities_1.getMutationDefinition(mutation);\n        result = mutationDefinition.selectionSet.selections.reduce(function (acc, elem) {\n            acc[apollo_utilities_1.resultKeyNameFromField(elem)] = null;\n            return acc;\n        }, {});\n    }\n    return result;\n};\nvar effect = function (store, client, effect, action, callback) { return __awaiter(void 0, void 0, void 0, function () {\n    var doIt, origOptimistic, _a, origVars, mutation, context, update, updateQueries, refetchQueries, fetchPolicy, observer, _b, idsMap, variables, optimisticResponse;\n    var _c;\n    return __generator(this, function (_d) {\n        switch (_d.label) {\n            case 0:\n                doIt = true;\n                origOptimistic = effect.optimisticResponse, _a = effect.operation, origVars = _a.variables, mutation = _a.query, context = _a.context, update = effect.update, updateQueries = effect.updateQueries, refetchQueries = effect.refetchQueries, fetchPolicy = effect.fetchPolicy, observer = effect.observer;\n                return [4 /*yield*/, client.hydrated()];\n            case 1:\n                _d.sent();\n                _b = cache_1.METADATA_KEY, idsMap = store.getState()[_b].idsMap;\n                variables = __assign(__assign({}, exports.replaceUsingMap(__assign({}, origVars), idsMap)), (_c = {}, _c[retry_link_1.SKIP_RETRY_KEY] = true, _c));\n                optimisticResponse = exports.replaceUsingMap(__assign({}, origOptimistic), idsMap);\n                return [2 /*return*/, new Promise(function (resolve, reject) {\n                        if (!client.queryManager) {\n                            client.initQueryManager();\n                        }\n                        var buildOperationForLink = client.queryManager.buildOperationForLink;\n                        var extraContext = __assign(__assign({ AASContext: {\n                                doIt: doIt\n                            } }, context), { optimisticResponse: optimisticResponse });\n                        var operation = buildOperationForLink.call(client.queryManager, mutation, variables, extraContext);\n                        logger('Executing link', operation);\n                        apollo_link_1.execute(client.link, operation).subscribe({\n                            next: function (data) {\n                                var _a;\n                                boundSaveServerId(store, optimisticResponse, data.data);\n                                var _b = store.getState(), _c = cache_1.METADATA_KEY, _d = _b[_c], idsMap = _d.idsMap, cacheSnapshot = _d.snapshot.cache, _e = _b.offline.outbox, enquededMutations = _e.slice(1);\n                                // Restore from cache snapshot\n                                client.cache.restore(cacheSnapshot);\n                                var dataStore = client.queryManager.dataStore;\n                                if (fetchPolicy !== 'no-cache') {\n                                    dataStore.markMutationResult({\n                                        mutationId: null,\n                                        result: data,\n                                        document: mutation,\n                                        variables: variables,\n                                        updateQueries: {},\n                                        update: update\n                                    });\n                                }\n                                exports.boundSaveSnapshot(store, client.cache);\n                                // Apply enqueued update functions to new cache\n                                var enqueuedActionsFilter = [\n                                    exports.offlineEffectConfig.enqueueAction\n                                ];\n                                enquededMutations\n                                    .filter(function (_a) {\n                                    var type = _a.type;\n                                    return enqueuedActionsFilter.indexOf(type) > -1;\n                                })\n                                    .forEach(function (_a) {\n                                    var effect = _a.meta.offline.effect;\n                                    var _b = effect, _c = _b.operation, _d = _c === void 0 ? {} : _c, _e = _d.variables, variables = _e === void 0 ? {} : _e, _f = _d.query, document = _f === void 0 ? null : _f, update = _b.update, origOptimisticResponse = _b.optimisticResponse, fetchPolicy = _b.fetchPolicy;\n                                    if (typeof update !== 'function') {\n                                        logger('No update function for mutation', { document: document, variables: variables });\n                                        return;\n                                    }\n                                    var optimisticResponse = exports.replaceUsingMap(__assign({}, origOptimisticResponse), idsMap);\n                                    var result = { data: optimisticResponse };\n                                    if (fetchPolicy !== 'no-cache') {\n                                        logger('Running update function for mutation', { document: document, variables: variables });\n                                        dataStore.markMutationResult({\n                                            mutationId: null,\n                                            result: result,\n                                            document: document,\n                                            variables: variables,\n                                            updateQueries: {},\n                                            update: update\n                                        });\n                                    }\n                                });\n                                client.queryManager.broadcastQueries();\n                                resolve({ data: data });\n                                if (observer.next && !observer.closed) {\n                                    observer.next(__assign(__assign({}, data), (_a = {}, _a[IS_OPTIMISTIC_KEY] = false, _a)));\n                                    observer.complete();\n                                }\n                                else {\n                                    // throw new Error('Manually interact with cache');\n                                }\n                                if (typeof callback === 'function') {\n                                    var mutationName_1 = utils_1.getOperationFieldName(mutation);\n                                    var _f = data.context || {}, _g = _f.additionalDataContext, _h = (_g === void 0 ? {} : _g).newVars, newVars_1 = _h === void 0 ? operation.variables : _h, restContext = __rest(_f, [\"additionalDataContext\"]);\n                                    if (!Object.keys(restContext || {}).length) {\n                                        delete data.context;\n                                    }\n                                    else {\n                                        data.context = restContext;\n                                    }\n                                    apollo_utilities_1.tryFunctionOrLogError(function () {\n                                        var errors = data.errors ? {\n                                            mutation: mutationName_1,\n                                            variables: newVars_1,\n                                            error: new apollo_client_1.ApolloError({\n                                                graphQLErrors: data.errors,\n                                            }),\n                                            notified: !!observer.next,\n                                        } : null;\n                                        var success = errors === null ? __assign(__assign({ mutation: mutationName_1, variables: newVars_1 }, data), { notified: !!observer.next }) : null;\n                                        callback(errors, success);\n                                    });\n                                }\n                            },\n                            error: function (err) {\n                                logger('Error when executing link', err);\n                                reject(err);\n                            }\n                        });\n                    })];\n        }\n    });\n}); };\nvar reducer = function (dataIdFromObject) { return function (state, action) {\n    var type = action.type, payload = action.payload;\n    switch (type) {\n        case constants_1.PERSIST_REHYDRATE:\n            var _a = cache_1.METADATA_KEY, rehydratedState = payload[_a];\n            return rehydratedState || state;\n        default:\n            var _b = state || {}, _c = _b.idsMap, origIdsMap = _c === void 0 ? {} : _c, _d = _b.snapshot, origSnapshot = _d === void 0 ? {} : _d, restState = __rest(_b, [\"idsMap\", \"snapshot\"]);\n            var snapshot = snapshotReducer(origSnapshot, action);\n            var idsMap = idsMapReducer(origIdsMap, __assign(__assign({}, action), { remainingMutations: snapshot.enqueuedMutations }), dataIdFromObject);\n            return __assign(__assign({}, restState), { snapshot: snapshot,\n                idsMap: idsMap });\n    }\n}; };\nvar snapshotReducer = function (state, action) {\n    var enqueuedMutations = enqueuedMutationsReducer(state && state.enqueuedMutations, action);\n    var cache = cacheSnapshotReducer(state && state.cache, __assign(__assign({}, action), { enqueuedMutations: enqueuedMutations }));\n    return {\n        enqueuedMutations: enqueuedMutations,\n        cache: cache,\n    };\n};\nvar enqueuedMutationsReducer = function (state, action) {\n    if (state === void 0) { state = 0; }\n    var type = action.type;\n    switch (type) {\n        case actions.ENQUEUE:\n            return state + 1;\n        case actions.COMMIT:\n        case actions.ROLLBACK:\n            return state - 1;\n        default:\n            return state;\n    }\n};\nvar cacheSnapshotReducer = function (state, action) {\n    if (state === void 0) { state = {}; }\n    var type = action.type, payload = action.payload;\n    switch (type) {\n        case actions.SAVE_SNAPSHOT:\n            var cache = payload.cache;\n            var cacheContents = __assign({}, cache.extract(false));\n            return cacheContents;\n        default:\n            return state;\n    }\n};\nvar boundSaveServerId = function (store, optimisticResponse, data) { return store.dispatch(saveServerId(optimisticResponse, data)); };\nvar saveServerId = function (optimisticResponse, data) { return ({\n    type: actions.SAVE_SERVER_ID,\n    payload: { data: data, optimisticResponse: optimisticResponse },\n}); };\nvar idsMapReducer = function (state, action, dataIdFromObject) {\n    if (state === void 0) { state = {}; }\n    var type = action.type, _a = action.payload, payload = _a === void 0 ? {} : _a;\n    var optimisticResponse = payload.optimisticResponse;\n    switch (type) {\n        case actions.ENQUEUE:\n            var ids = exports.getIds(dataIdFromObject, optimisticResponse);\n            var entries = Object.values(ids).reduce(function (acc, id) { return (acc[id] = null, acc); }, {});\n            return __assign(__assign({}, state), entries);\n        case actions.COMMIT:\n            var remainingMutations = action.remainingMutations;\n            // Clear ids map on last mutation\n            return remainingMutations ? state : {};\n        case actions.SAVE_SERVER_ID:\n            var data = payload.data;\n            var oldIds = exports.getIds(dataIdFromObject, optimisticResponse);\n            var newIds = exports.getIds(dataIdFromObject, data);\n            var mapped = mapIds(oldIds, newIds);\n            return __assign(__assign({}, state), mapped);\n        default:\n            return state;\n    }\n};\nvar discard = function (callback, error, action, retries) {\n    var discardResult = _discard(error, action, retries);\n    if (discardResult) {\n        // Call global error callback and observer\n        var observer = action.meta.offline.effect.observer;\n        if (observer && !observer.closed) {\n            observer.error(error);\n        }\n        if (typeof callback === 'function') {\n            apollo_utilities_1.tryFunctionOrLogError(function () {\n                callback({ error: error }, null);\n            });\n        }\n    }\n    return discardResult;\n};\nvar _discard = function (error, action, retries) {\n    var _a = error.graphQLErrors, graphQLErrors = _a === void 0 ? [] : _a;\n    if (graphQLErrors.length) {\n        logger('Discarding action.', action, graphQLErrors);\n        return true;\n    }\n    else {\n        var _b = error.networkError, _c = (_b === void 0 ? { graphQLErrors: [] } : _b).graphQLErrors, graphQLErrors_1 = _c === void 0 ? [] : _c;\n        var appSyncClientError = graphQLErrors_1.find(function (err) { return err.errorType && err.errorType.startsWith('AWSAppSyncClient:'); });\n        if (appSyncClientError) {\n            logger('Discarding action.', action, appSyncClientError);\n            return true;\n        }\n    }\n    return error.permanent || retries > 10;\n};\n//#region utils\nexports.replaceUsingMap = function (obj, map) {\n    if (map === void 0) { map = {}; }\n    if (!obj || !map) {\n        return obj;\n    }\n    var newVal = map[obj];\n    if (newVal) {\n        obj = newVal;\n        return obj;\n    }\n    if (typeof obj === 'object') {\n        Object.keys(obj).forEach(function (key) {\n            var val = obj[key];\n            if (Array.isArray(val)) {\n                obj[key] = val.map(function (v, i) { return exports.replaceUsingMap(v, map); });\n            }\n            else if (typeof val === 'object') {\n                obj[key] = exports.replaceUsingMap(val, map);\n            }\n            else {\n                var newVal_1 = map[val];\n                if (newVal_1) {\n                    obj[key] = newVal_1;\n                }\n            }\n        });\n    }\n    return obj;\n};\nexports.getIds = function (dataIdFromObject, obj, path, acc) {\n    if (path === void 0) { path = ''; }\n    if (acc === void 0) { acc = {}; }\n    if (!obj) {\n        return acc;\n    }\n    if (typeof obj === 'object') {\n        var dataId = dataIdFromObject(obj);\n        if (dataId) {\n            var _a = dataId.match(/(.+:)?(.+)/) || [], _b = _a[2], id = _b === void 0 ? null : _b;\n            if (utils_1.isUuid(dataId)) {\n                acc[path] = id;\n            }\n        }\n        Object.keys(obj).forEach(function (key) {\n            var val = obj[key];\n            if (Array.isArray(val)) {\n                val.forEach(function (v, i) { return exports.getIds(dataIdFromObject, v, path + \".\" + key + \"[\" + i + \"]\", acc); });\n            }\n            else if (typeof val === 'object') {\n                exports.getIds(dataIdFromObject, val, \"\" + path + (path && '.') + key, acc);\n            }\n        });\n    }\n    return exports.getIds(dataIdFromObject, null, path, acc);\n};\nvar intersectingKeys = function (obj1, obj2) {\n    if (obj1 === void 0) { obj1 = {}; }\n    if (obj2 === void 0) { obj2 = {}; }\n    var keys1 = Object.keys(obj1);\n    var keys2 = Object.keys(obj2);\n    return keys1.filter(function (k) { return keys2.indexOf(k) !== -1; });\n};\nvar mapIds = function (obj1, obj2) { return intersectingKeys(obj1, obj2).reduce(function (acc, k) { return (acc[obj1[k]] = obj2[k], acc); }, {}); };\n//#endregion\nexports.offlineEffectConfig = {\n    enqueueAction: actions.ENQUEUE,\n    effect: effect,\n    discard: discard,\n    reducer: reducer,\n};\n"]},"metadata":{},"sourceType":"script"}