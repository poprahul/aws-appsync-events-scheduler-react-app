{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*!\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nvar apollo_client_1 = require(\"apollo-client\");\n\nvar apollo_link_1 = require(\"apollo-link\");\n\nvar apollo_link_2 = require(\"apollo-link\");\n\nvar apollo_utilities_1 = require(\"apollo-utilities\");\n\nvar graphql_1 = require(\"graphql\");\n\nvar complex_object_link_uploader_1 = require(\"./complex-object-link-uploader\");\n\nvar ComplexObjectLink =\n/** @class */\nfunction (_super) {\n  __extends(ComplexObjectLink, _super);\n\n  function ComplexObjectLink(credentials) {\n    var _this = _super.call(this) || this;\n\n    _this.link = exports.complexObjectLink(credentials);\n    return _this;\n  }\n\n  ComplexObjectLink.prototype.request = function (operation, forward) {\n    return this.link.request(operation, forward);\n  };\n\n  return ComplexObjectLink;\n}(apollo_link_2.ApolloLink);\n\nexports.ComplexObjectLink = ComplexObjectLink;\n\nexports.complexObjectLink = function (credentials) {\n  return new apollo_link_2.ApolloLink(function (operation, forward) {\n    return new apollo_link_1.Observable(function (observer) {\n      var handle;\n      var operationType = apollo_utilities_1.getOperationDefinition(operation.query).operation;\n      var isMutation = operationType === 'mutation';\n      var objectsToUpload = isMutation ? findInObject(operation.variables) : {};\n      var uploadPromise = Promise.resolve(operation);\n\n      if (Object.keys(objectsToUpload).length) {\n        var uploadCredentials = typeof credentials === 'function' ? credentials.call() : credentials;\n        uploadPromise = Promise.resolve(uploadCredentials).then(function (credentials) {\n          var uploadPromises = Object.entries(objectsToUpload).map(function (_a) {\n            var _ = _a[0],\n                fileField = _a[1];\n            return complex_object_link_uploader_1.default(fileField, {\n              credentials: credentials\n            });\n          });\n          return Promise.all(__spreadArrays([operation], uploadPromises));\n        }).then(function (_a) {\n          var operation = _a[0],\n              all = _a.slice(1);\n\n          return operation;\n        }).catch(function (err) {\n          var error = new graphql_1.GraphQLError(err.message);\n          error.errorType = 'AWSAppSyncClient:S3UploadException';\n          throw new apollo_client_1.ApolloError({\n            graphQLErrors: [error],\n            extraInfo: err\n          });\n        });\n      }\n\n      uploadPromise.then(forward).then(function (observable) {\n        handle = observable.subscribe({\n          next: observer.next.bind(observer),\n          error: observer.error.bind(observer),\n          complete: observer.complete.bind(observer)\n        });\n      }).catch(function (err) {\n        observer.error(err);\n      });\n      return function () {\n        if (handle) handle.unsubscribe();\n      };\n    });\n  });\n};\n\nvar complexObjectFields = [{\n  name: 'bucket',\n  type: 'string'\n}, {\n  name: 'key',\n  type: 'string'\n}, {\n  name: 'region',\n  type: 'string'\n}, {\n  name: 'mimeType',\n  type: 'string'\n}, {\n  name: 'localUri',\n  type: ['object', 'string']\n}];\n\nvar findInObject = function (obj) {\n  var testFn = function (val) {\n    return complexObjectFields.every(function (field) {\n      var hasValue = val[field.name];\n      var types = Array.isArray(field.type) ? field.type : [field.type];\n      var isOfType = hasValue && types.reduce(function (prev, curr) {\n        return prev || typeof val[field.name] === curr;\n      }, false);\n      return isOfType;\n    });\n  };\n\n  var _findInObject = function (obj, path, acc) {\n    if (path === void 0) {\n      path = '';\n    }\n\n    if (acc === void 0) {\n      acc = {};\n    }\n\n    if (!obj) {\n      return acc;\n    }\n\n    if (testFn(obj)) {\n      acc[path] = __assign({}, obj);\n      delete obj.mimeType;\n      delete obj.localUri;\n    }\n\n    if (typeof obj === 'object') {\n      Object.keys(obj).forEach(function (key) {\n        var val = obj[key];\n\n        if (Array.isArray(val)) {\n          val.forEach(function (v, i) {\n            return _findInObject(v, path + \".\" + key + \"[\" + i + \"]\", acc);\n          });\n        } else if (typeof val === 'object') {\n          _findInObject(val, \"\" + path + (path && '.') + key, acc);\n        }\n      });\n    }\n\n    return _findInObject(null, path, acc);\n  };\n\n  return _findInObject(obj);\n};","map":{"version":3,"sources":["/Users/poprahul/workspace/frontend/amplify-apps/calandarApp/aws-mobile-appsync-events-starter-react/node_modules/aws-appsync/lib/link/complex-object-link.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__spreadArrays","il","r","k","a","j","jl","defineProperty","exports","value","apollo_client_1","require","apollo_link_1","apollo_link_2","apollo_utilities_1","graphql_1","complex_object_link_uploader_1","ComplexObjectLink","_super","credentials","_this","link","complexObjectLink","request","operation","forward","ApolloLink","Observable","observer","handle","operationType","getOperationDefinition","query","isMutation","objectsToUpload","findInObject","variables","uploadPromise","Promise","resolve","keys","uploadCredentials","then","uploadPromises","entries","map","_a","_","fileField","default","all","slice","catch","err","error","GraphQLError","message","errorType","ApolloError","graphQLErrors","extraInfo","observable","subscribe","next","bind","complete","unsubscribe","complexObjectFields","name","type","obj","testFn","val","every","field","hasValue","types","isArray","isOfType","reduce","prev","curr","_findInObject","path","acc","mimeType","localUri","forEach","key","v"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/*!\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nvar apollo_client_1 = require(\"apollo-client\");\nvar apollo_link_1 = require(\"apollo-link\");\nvar apollo_link_2 = require(\"apollo-link\");\nvar apollo_utilities_1 = require(\"apollo-utilities\");\nvar graphql_1 = require(\"graphql\");\nvar complex_object_link_uploader_1 = require(\"./complex-object-link-uploader\");\nvar ComplexObjectLink = /** @class */ (function (_super) {\n    __extends(ComplexObjectLink, _super);\n    function ComplexObjectLink(credentials) {\n        var _this = _super.call(this) || this;\n        _this.link = exports.complexObjectLink(credentials);\n        return _this;\n    }\n    ComplexObjectLink.prototype.request = function (operation, forward) {\n        return this.link.request(operation, forward);\n    };\n    return ComplexObjectLink;\n}(apollo_link_2.ApolloLink));\nexports.ComplexObjectLink = ComplexObjectLink;\nexports.complexObjectLink = function (credentials) {\n    return new apollo_link_2.ApolloLink(function (operation, forward) {\n        return new apollo_link_1.Observable(function (observer) {\n            var handle;\n            var operationType = apollo_utilities_1.getOperationDefinition(operation.query).operation;\n            var isMutation = operationType === 'mutation';\n            var objectsToUpload = isMutation ? findInObject(operation.variables) : {};\n            var uploadPromise = Promise.resolve(operation);\n            if (Object.keys(objectsToUpload).length) {\n                var uploadCredentials = typeof credentials === 'function' ? credentials.call() : credentials;\n                uploadPromise = Promise.resolve(uploadCredentials)\n                    .then(function (credentials) {\n                    var uploadPromises = Object.entries(objectsToUpload).map(function (_a) {\n                        var _ = _a[0], fileField = _a[1];\n                        return complex_object_link_uploader_1.default(fileField, { credentials: credentials });\n                    });\n                    return Promise.all(__spreadArrays([operation], uploadPromises));\n                })\n                    .then(function (_a) {\n                    var operation = _a[0], all = _a.slice(1);\n                    return operation;\n                })\n                    .catch(function (err) {\n                    var error = new graphql_1.GraphQLError(err.message);\n                    error.errorType = 'AWSAppSyncClient:S3UploadException';\n                    throw new apollo_client_1.ApolloError({\n                        graphQLErrors: [error],\n                        extraInfo: err,\n                    });\n                });\n            }\n            uploadPromise\n                .then(forward)\n                .then(function (observable) {\n                handle = observable.subscribe({\n                    next: observer.next.bind(observer),\n                    error: observer.error.bind(observer),\n                    complete: observer.complete.bind(observer),\n                });\n            }).catch(function (err) {\n                observer.error(err);\n            });\n            return function () {\n                if (handle)\n                    handle.unsubscribe();\n            };\n        });\n    });\n};\nvar complexObjectFields = [\n    { name: 'bucket', type: 'string' },\n    { name: 'key', type: 'string' },\n    { name: 'region', type: 'string' },\n    { name: 'mimeType', type: 'string' },\n    { name: 'localUri', type: ['object', 'string'] },\n];\nvar findInObject = function (obj) {\n    var testFn = function (val) {\n        return complexObjectFields.every(function (field) {\n            var hasValue = val[field.name];\n            var types = Array.isArray(field.type) ? field.type : [field.type];\n            var isOfType = hasValue && types.reduce(function (prev, curr) {\n                return prev || typeof val[field.name] === curr;\n            }, false);\n            return isOfType;\n        });\n    };\n    var _findInObject = function (obj, path, acc) {\n        if (path === void 0) { path = ''; }\n        if (acc === void 0) { acc = {}; }\n        if (!obj) {\n            return acc;\n        }\n        if (testFn(obj)) {\n            acc[path] = __assign({}, obj);\n            delete obj.mimeType;\n            delete obj.localUri;\n        }\n        if (typeof obj === 'object') {\n            Object.keys(obj).forEach(function (key) {\n                var val = obj[key];\n                if (Array.isArray(val)) {\n                    val.forEach(function (v, i) { return _findInObject(v, path + \".\" + key + \"[\" + i + \"]\", acc); });\n                }\n                else if (typeof val === 'object') {\n                    _findInObject(val, \"\" + path + (path && '.') + key, acc);\n                }\n            });\n        }\n        return _findInObject(null, path, acc);\n    };\n    return _findInObject(obj);\n};\n"]},"metadata":{},"sourceType":"script"}